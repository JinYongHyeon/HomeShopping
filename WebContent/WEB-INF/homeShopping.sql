
--사용자
CREATE TABLE HOMESHOPPING_USER(
	ID VARCHAR2(300) PRIMARY KEY,
	PASSWORD VARCHAR2(200) NOT NULL,
	NAME VARCHAR2(200) NOT NULL,
	ADDRESS VARCHAR2(300) NOT NULL,
	TELEPHONE VARCHAR2(200) NOT NULL,
	EMAIL VARCHAR2(400) NOT NULL,
	POINT NUMBER DEFAULT 0 NOT NULL
);

--주문
CREATE TABLE HOMESHOPPING_ORDER(
 order_no NUMBER PRIMARY KEY,
 order_date DATE NOT NULL,
 recipient_name VARCHAR2(300) NOT NULL,
 recipient_address VARCHAR2(300) NOT NULL,
 recipient_telephone VARCHAR2(300)NOT NULL,
 id VARCHAR2(300) NOT NULL
 CONSTRAINT homeshopping_order_fk REFERENCES HOMESHOPPING_USER(id) ON DELETE CASCADE 
);


--상품
CREATE TABLE HOMESHOPPING_PRODUCT(
	 product_no NUMBER PRIMARY KEY,
	 product_name VARCHAR2(300) NOT NULL,
	 product_price NUMBER NOT NULL,
	 product_content CLOB NOT NULL,
	 product_main_img VARCHAR2(300),
	 product_possesion_count NUMBER DEFAULT 0 NOT NULL ,
	 product_date DATE NOT NULL,
	 product_total_sale NUMBER DEFAULT 0 NOT NULL ,
	 product_kinds VARCHAR2(300)
)
ALTER TABLE HOMESHOPPING_PRODUCT ADD product_kinds VARCHAR(300) NOT NULL

--주문 상세
CREATE TABLE HOMESHOPPING_ORDER_DETAIL(
	order_no NUMBER NOT NULL,
	product_no NUMBER NOT NULL, 
	order_count NUMBER NOT NULL,
	order_price NUMBER NOT NULL,
	CONSTRAINT HOMESHOPPING_ORDER_DETAIL_pk PRIMARY KEY (order_no,product_no),
	CONSTRAINT ORDER_DETAIL_ORDER_NO_FK FOREIGN KEY(order_no) REFERENCES HOMESHOPPING_ORDER(order_no) ON DELETE CASCADE ,
	CONSTRAINT PRODUCT_PRODUCT_NO_FK FOREIGN KEY(product_no) REFERENCES HOMESHOPPING_PRODUCT(product_no) ON DELETE CASCADE 
)
--쇼핑백
CREATE TABLE shopping_basket(
	product_no NUMBER NOT NULL,
	id VARCHAR2(300) NOT NULL,
	shopping_basket_count NUMBER  DEFAULT 1 NOT NULL,
	shopping_basket_price NUMBER NOT NULL, 
	CONSTRAINT shopping_pk PRIMARY KEY (product_no,id),
	CONSTRAINT shopping_product_no_pk FOREIGN KEY(product_no) REFERENCES HOMESHOPPING_PRODUCT(product_no) ON DELETE CASCADE ,
	CONSTRAINT shopping_id_pk FOREIGN KEY(id) REFERENCES HOMESHOPPING_USER(id) ON DELETE CASCADE 
)

--시퀀스 생성
--주문
CREATE SEQUENCE order_no_seq; 
--상품
CREATE SEQUENCE product_no_seq; 

DROP SEQUENCE order_no_seq;
DROP SEQUENCE product_no_seq;




--테이블 삭제
DROP TABLE HOMESHOPPING_USER;
DROP TABLE HOMESHOPPING_ORDER;
DROP TABLE HOMESHOPPING_PRODUCT;
DROP TABLE HOMESHOPPING_ORDER_DETAIL;
DROP TABLE shopping_basket;


SELECT PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_MAIN_IMG,PRODUCT_POSSESION_COUNT,TO_CHAR(PRODUCT_DATE,'YYYY/MM/DD') AS 등록일,PRODUCT_TOTAL_SALE
FROM HOMESHOPPING_PRODUCT
ORDER BY PRODUCT_NO ASC



SELECT ID,PASSWORD,NAME,ADDRESS,TELEPHONE,EMAIL,TOTAL_PURCHASE FROM HOMESHOPPING_USER
WHERE ID LIKE '%user%'

SELECT rnum,ID,PASSWORD,NAME,ADDRESS,TELEPHONE,EMAIL,TOTAL_PURCHASE FROM(
SELECT ROW_NUMBER() OVER(ORDER BY ID ASC) AS rnum,ID,PASSWORD,NAME,ADDRESS,TELEPHONE,EMAIL,TOTAL_PURCHASE FROM HOMESHOPPING_USER)H
WHERE rnum BETWEEN 2 AND 3

SELECT rnum,ID,PASSWORD,NAME,ADDRESS,TELEPHONE,EMAIL,TOTAL_PURCHASE FROM(
SELECT ROW_NUMBER() OVER(ORDER BY ID ASC) AS rnum,ID,PASSWORD,NAME,ADDRESS,TELEPHONE,EMAIL,TOTAL_PURCHASE FROM HOMESHOPPING_USER WHERE ID LIKE '%user%')H
WHERE rnum BETWEEN 5 AND 15

--상품 샘플 DB
INSERT INTO HOMESHOPPING_PRODUCT(PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_CONTENT,product_main_img,product_possesion_count,PRODUCT_DATE,PRODUCT_KINDS) VALUES(
product_no_seq.NEXTVAL,'유니섹스 파스텔 웰론 숏패딩 카키그레이 IRO053',99000,'아우터1-상세.jpg','아우터1.jpg',30,SYSDATE,'아우터');
INSERT INTO HOMESHOPPING_PRODUCT(PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_CONTENT,product_main_img,product_possesion_count,PRODUCT_DATE,PRODUCT_KINDS) VALUES(
product_no_seq.NEXTVAL,'유니섹스 파스텔 웰론 숏패딩 아이보리 IRO053',99000,'아우터2-상세.jpg','아우터2.jpg',30,SYSDATE,'아우터');
INSERT INTO HOMESHOPPING_PRODUCT(PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_CONTENT,product_main_img,product_possesion_count,PRODUCT_DATE,PRODUCT_KINDS) VALUES(
product_no_seq.NEXTVAL,'유니섹스 파스텔 웰론 숏패딩 블랙 IRO053',99000,'아우터3-상세.jpg','아우터3.jpg',30,SYSDATE,'아우터');
INSERT INTO HOMESHOPPING_PRODUCT(PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_CONTENT,product_main_img,product_possesion_count,PRODUCT_DATE,PRODUCT_KINDS) VALUES(
product_no_seq.NEXTVAL,'유니섹스 크루넥 시보리 웰론 숏패딩 화이트 IRO052',99000,'아우터4-상세.jpg','아우터4.jpg',30,SYSDATE,'아우터');
INSERT INTO HOMESHOPPING_PRODUCT(PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_CONTENT,product_main_img,product_possesion_count,PRODUCT_DATE,PRODUCT_KINDS) VALUES(
product_no_seq.NEXTVAL,' 유니섹스 크루넥 시보리 웰론 숏패딩 그레이 IRO052 ',99000,'아우터5-상세.jpg','아우터5.jpg',30,SYSDATE,'아우터');
INSERT INTO HOMESHOPPING_PRODUCT(PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_CONTENT,product_main_img,product_possesion_count,PRODUCT_DATE,PRODUCT_KINDS) VALUES(
product_no_seq.NEXTVAL,'유니섹스 크루넥 시보리 웰론 숏패딩 블랙 IRO052',99000,'아우터6-상세.jpg','아우터6.jpg',30,SYSDATE,'아우터');
INSERT INTO HOMESHOPPING_PRODUCT(PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_CONTENT,product_main_img,product_possesion_count,PRODUCT_DATE,PRODUCT_KINDS) VALUES(
product_no_seq.NEXTVAL,'유니섹스 크루넥 시보리 웰론 숏패딩 베이지 IRO052 ',99000,'아우터7-상세.jpg','아우터7.jpg',30,SYSDATE,'아우터');
INSERT INTO HOMESHOPPING_PRODUCT(PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_CONTENT,product_main_img,product_possesion_count,PRODUCT_DATE,PRODUCT_KINDS) VALUES(
product_no_seq.NEXTVAL,'20fw 디테처블 남성 패딩/8018731',99000,'아우터8-상세.jpg','아우터8.jpg',30,SYSDATE,'아우터');
INSERT INTO HOMESHOPPING_PRODUCT(PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_CONTENT,product_main_img,product_possesion_count,PRODUCT_DATE,PRODUCT_KINDS) VALUES(
product_no_seq.NEXTVAL,'20fw 라멘틴 남성 패딩/1B58300 539WF 999',99000,'아우터9-상세.jpg','아우터9.jpg',30,SYSDATE,'아우터');
INSERT INTO HOMESHOPPING_PRODUCT(PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_CONTENT,product_main_img,product_possesion_count,PRODUCT_DATE,PRODUCT_KINDS) VALUES(
product_no_seq.NEXTVAL,'20fw 쓰리쿼터 남성패딩/MK2228M3Q 402',99000,'아우터10-상세.jpg','아우터10.jpg',30,SYSDATE,'아우터');
INSERT INTO HOMESHOPPING_PRODUCT(PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_CONTENT,product_main_img,product_possesion_count,PRODUCT_DATE,PRODUCT_KINDS) VALUES(
product_no_seq.NEXTVAL,'20fw 남성 발리스틱 봄버 블랙퍼/MK2000MB 402',99000,'아우터11-상세.jpg','아우터11.jpg',30,SYSDATE,'아우터');
INSERT INTO HOMESHOPPING_PRODUCT(PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_CONTENT,product_main_img,product_possesion_count,PRODUCT_DATE,PRODUCT_KINDS) VALUES(
product_no_seq.NEXTVAL,'SA 덕 다운 후디 숏 패딩_블루 그레이',99000,'아우터12-상세.jpg','아우터12.jpg',30,SYSDATE,'아우터');
INSERT INTO HOMESHOPPING_PRODUCT(PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_CONTENT,product_main_img,product_possesion_count,PRODUCT_DATE,PRODUCT_KINDS) VALUES(
product_no_seq.NEXTVAL,'SA 덕 다운 후디 숏 패딩_블랙',99000,'아우터13-상세.jpg','아우터13.jpg',30,SYSDATE,'아우터');
INSERT INTO HOMESHOPPING_PRODUCT(PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_CONTENT,product_main_img,product_possesion_count,PRODUCT_DATE,PRODUCT_KINDS) VALUES(
product_no_seq.NEXTVAL,'SA 로열 라이더스 퍼 자켓_블랙',99000,'아우터14-상세.jpg','아우터14.jpg',30,SYSDATE,'아우터');
INSERT INTO HOMESHOPPING_PRODUCT(PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_CONTENT,product_main_img,product_possesion_count,PRODUCT_DATE,PRODUCT_KINDS) VALUES(
product_no_seq.NEXTVAL,'로고 UV0CNA316SQ A01 남자 패딩 점퍼 자켓 레귤러핏',99000,'아우터15-상세.jpg','아우터15.jpg',30,SYSDATE,'아우터');
INSERT INTO HOMESHOPPING_PRODUCT(PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_CONTENT,product_main_img,product_possesion_count,PRODUCT_DATE,PRODUCT_KINDS) VALUES(
product_no_seq.NEXTVAL,'[패키지] 빅로고 양털 누빔 자켓 (3컬러)',99000,'아우터16-상세.jpg','아우터16.jpg',30,SYSDATE,'아우터');


SELECT PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_MAIN_IMG,PRODUCT_POSSESION_COUNT,PRODUCT_DATE,PRODUCT_TOTAL_SALE,PRODUCT_KINDS
FROM (SELECT ROW_NUMBER() OVER(ORDER BY PRODUCT_NO ASC) AS RNUM,PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_MAIN_IMG,PRODUCT_POSSESION_COUNT,
TO_CHAR(PRODUCT_DATE,'YYYY/MM/DD') AS PRODUCT_DATE,PRODUCT_TOTAL_SALE,PRODUCT_KINDS FROM HOMESHOPPING_PRODUCT)H
WHERE RNUM BETWEEN 5 AND 10

--상품 NEW BEST 10개 조회
SELECT rnum,PRODUCT_NO,PRODUCT_MAIN_IMG, PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_TOTAL_SALE
FROM (SELECT ROW_NUMBER() OVER(ORDER BY PRODUCT_DATE DESC) AS rnum,PRODUCT_NO,PRODUCT_MAIN_IMG,
PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_TOTAL_SALE FROM HOMESHOPPING_PRODUCT)
WHERE rnum < 10

--상품 HOT BEST 10개 조회
SELECT rnum,PRODUCT_NO,PRODUCT_MAIN_IMG, PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_TOTAL_SALE
FROM (SELECT ROW_NUMBER() OVER(ORDER BY PRODUCT_TOTAL_SALE DESC) AS rnum,PRODUCT_NO,PRODUCT_MAIN_IMG,
PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_TOTAL_SALE FROM HOMESHOPPING_PRODUCT)
WHERE rnum < 10

--상품 종류별 검색
SELECT PRODUCT_NO,PRODUCT_MAIN_IMG, PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_TOTAL_SALE,PRODUCT_KINDS
FROM (SELECT ROW_NUMBER() OVER(ORDER BY PRODUCT_TOTAL_SALE DESC) AS rnum,PRODUCT_NO,PRODUCT_MAIN_IMG,
PRODUCT_NAME,PRODUCT_PRICE,PRODUCT_KINDS,PRODUCT_TOTAL_SALE FROM HOMESHOPPING_PRODUCT WHERE PRODUCT_KINDS = '반팔')
WHERE rnum < 10

UPDATE HOMESHOPPING_PRODUCT set PRODUCT_KINDS = '상의'

--장바구니 추가
INSERT INTO SHOPPING_BASKET(product_no,id,shopping_basket_price) VALUES(114,'user1',13500)

SELECT * FROM SHOPPING_BASKET

--상품 정보 조회
SELECT PRODUCT_NO,PRODUCT_NAME,PRODUCT_PRICE FROM HOMESHOPPING_PRODUCT WHERE PRODUCT_NO =1

--장바구니 리스트 페이징
SELECT s.product_no,s.id,s.shopping_basket_count,s.shopping_basket_price,p.product_name,p.PRODUCT_MAIN_IMG
FROM (SELECT ROW_NUMBER() OVER(ORDER BY id ASC) AS RNUM,product_no,id,shopping_basket_count,shopping_basket_price FROM SHOPPING_BASKET WHERE id='user1')s,HOMESHOPPING_PRODUCT p 
WHERE s.product_no=p.product_no and rnum BETWEEN 2 AND 3